name: Deploy to AlwaysData

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Ã‰tape 1 : rÃ©cupÃ©rer le code depuis GitHub
      - uses: actions/checkout@v3

      # Ã‰tape 2 : dÃ©ployer sur AlwaysData via SSH
      - name: Deploy via SSH to AlwaysData
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ssh-sae-manager.alwaysdata.net
          username: sae-manager
          key: ${{ secrets.SSH_KEY }}
          script: |
            # Aller dans le rÃ©pertoire du site
            cd /home/sae-manager/www/Sae_Manager || exit 1

            echo "ðŸ”„ Fetching latest code from GitHub..."
            git fetch origin main || exit 1
            git reset --hard origin/main || exit 1

            echo "ðŸ”§ Setting correct permissions..."
            find . -type d -exec chmod 755 {} \;
            find . -type f -exec chmod 644 {} \;

            echo "âœ… Deployment completed successfully"
